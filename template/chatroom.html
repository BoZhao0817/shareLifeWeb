{% extends "base.html" %}


{% block content %}
<!--聊天框-->
<div class="list-group col-md-10 col-md-offset-1 well">
    <div class="list-group-item">
        {% for chat in chats %}
        <h4 class="list-group-item-heading">{{chat.sender}}:{{chat.content}}</h4>
        <p class="list-group-item-text">{{chat.time}}</p>
        <input type="hidden" class="chat_id" value="{{chat.id}}"/>
        <br>
        {% endfor %}
    </div>
</div>
<!--表单-->
<form id="chatForm" class="form-horizontal panel container" method="POST" action=".">{% csrf_token %}
    <div class="form-group col-md-10">
        <textarea type="text" name="content" id="content" value="" class="form-control" id="exampleMessage" placeholder=""></textarea>
    </div>
    <div class="form-group col-md-4">
        <input type="hidden" name="post_type" value="send_chat"/>
        <input type="submit" class="btn btn-lg btn-primary" value="发送"/>
    </div>
</form>
{% endblock %}

{% block script %}
<script>
 $(function() {
    updateMsg();
    $("#chatForm").submit(function() {
        //ajax 提交表单
        $.post("./post/",
            $('#chatForm').serialize(),
            function(data) {
            $("#content").val("");
        });
        return false;
    });
});

//更新消息
function updateMsg() {
    $.post(
        "./post/",
        {
        post_type: "get_chat",
        last_chat_id: $(".chat_id").last().val()
        },
        function(data) {
            $('.list-group-item').append(data);    xml
    });
    setTimeout("updateMsg()", 1000);        //每秒更新一次
}
</script>
{% endblock %}
